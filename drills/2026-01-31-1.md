# Ruby/Rails デイリードリル - 2026-01-31（セッション1）

## 本日のドリル

### 問題1
以下のRubyコードの出力として正しいものはどれですか？

```ruby
hash = { a: 1, b: 2, c: 3 }
hash.delete_if { |k, v| v % 2 == 1 }
p hash
```

**選択肢：**
- a) `{:b=>2}`
- b) `{:a=>1, :c=>3}`
- c) `{:a=>1, :b=>2, :c=>3}`
- d) `{}`

**正解：** a

**解説：**
このコードでは `delete_if` メソッドを使って、特定の条件に合致する要素をハッシュから削除しています。

処理を追ってみると：
1. `hash = { a: 1, b: 2, c: 3 }` でハッシュを初期化します。
2. `hash.delete_if { |k, v| v % 2 == 1 }` で、「値を2で割った余りが1」、つまり「奇数の値」を持つ要素をすべて削除します。

各要素を確認すると：
- `a: 1` → 1は奇数（1 % 2 == 1）なので**削除されます**
- `b: 2` → 2は偶数（2 % 2 == 0）なので**残ります**
- `c: 3` → 3は奇数（3 % 2 == 1）なので**削除されます**

したがって、残るのは `{:b=>2}` だけになります。

`delete_if`メソッドは元のハッシュを直接変更する（破壊的な）メソッドであることにも注意が必要です。これに対して非破壊的な`reject`メソッドもあり、こちらは新しいハッシュを返します。

**公式リファレンス:**
- [Hash#delete_if - Ruby 3.2 リファレンス](https://docs.ruby-lang.org/ja/latest/method/Hash/i/delete_if.html)

---

### 問題2
Railsアプリケーションで、以下のようなルーティング定義があるとき、`articles#show`アクションにアクセスするためのパスヘルパーとして正しいものはどれですか？

```ruby
Rails.application.routes.draw do
  resources :articles, only: [:index, :show, :new, :create]
  
  namespace :admin do
    resources :articles
  end
end
```

**選択肢：**
- a) `article_path(@article)`
- b) `articles_path(@article)`
- c) `articles_show_path(@article)`
- d) `admin_article_path(@article)`

**正解：** a

**解説：**
Railsのリソースベースのルーティング（`resources :articles`）では、各アクションに対応するパスヘルパーが自動的に生成されます。その命名規則に従うと：

- **index**アクション（一覧表示）→ `articles_path`
- **show**アクション（詳細表示）→ `article_path(@article)`
- **new**アクション（新規作成フォーム）→ `new_article_path`
- **edit**アクション（編集フォーム）→ `edit_article_path(@article)`
- **create**, **update**, **destroy**アクション → 対応するHTTPメソッドでindex/showと同じパスを使用

注目すべき点：
1. **単数/複数形**: コレクション（index）に関するパスは複数形（`articles_path`）、単一リソース（show）に関するパスは単数形（`article_path`）になります。
2. **引数**: 特定の記事を扱うアクション（show, edit, update, destroy）では、どの記事かを特定するために`@article`オブジェクトを渡す必要があります。

`articles_show_path`のようなパスヘルパーは存在しません。また、`admin_article_path`はnamespaceを使って定義された管理者用のパスで、通常の`articles#show`アクションとは異なります。

**公式リファレンス:**
- [Rails のルーティング | Rails ガイド](https://railsguides.jp/routing.html#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0-rails-%E3%81%AE%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88)

---

### 問題3
以下のRubyコードの出力として正しいものはどれですか？

```ruby
class MyClass
  @@count = 0
  
  def initialize
    @@count += 1
  end
  
  def self.count
    @@count
  end
end

3.times { MyClass.new }
p MyClass.count
```

**選択肢：**
- a) `0`
- b) `1`
- c) `3`
- d) エラーが発生する

**正解：** c

**解説：**
この問題はRubyのクラス変数（`@@`から始まる変数）についての理解を問うものです。

クラス変数の重要な特性：
1. クラス変数はクラスの**すべてのインスタンスで共有**されます
2. クラス自身からも、そのインスタンスからもアクセスできます

このコードでの処理の流れ：
1. まず `@@count = 0` でクラス変数を0に初期化
2. `initialize`メソッド内で `@@count += 1` としているので、**インスタンスが作成されるたびにカウントが1増える**
3. `3.times { MyClass.new }` で3つのインスタンスを作成
4. 各インスタンス作成時に `@@count` が1ずつ増えるので、最終的に `@@count` は3になる
5. `MyClass.count` でクラスメソッドを呼び出し、共有されている `@@count` の値である3を取得

クラス変数とインスタンス変数は「優先」の関係ではなく、異なる用途と範囲を持つ変数です：
- クラス変数（`@@count`）：クラス全体で共有される
- インスタンス変数（`@count`）：各インスタンス固有のもの

このようなクラス変数の仕組みは、作成されたインスタンスの数を追跡するなど、クラス全体で情報を共有したい場合に便利です。

**公式リファレンス:**
- [クラス変数 - Ruby 3.2 リファレンス](https://docs.ruby-lang.org/ja/latest/doc/spec=2fvariables.html#class)

---

## 結果

**正解数：** 2/3

**今日のポイント：**
1. `delete_if`メソッドを使ったハッシュの条件付き要素削除
2. Railsのリソースベースのルーティングにおけるパスヘルパーの命名規則
3. Rubyのクラス変数とその共有の仕組み