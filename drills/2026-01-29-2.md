# Ruby/Rails デイリードリル - 2026-01-29（セッション2）

## 本日のドリル

### 問題1

以下のRubyコードの出力として正しいものはどれですか？

```ruby
module Greetable
  def hello
    "Hello from module"
  end
end

class Person
  include Greetable

  def hello
    "Hello from class"
  end
end

p = Person.new
puts p.hello
```

**選択肢：**

- a) "Hello from module"
- b) "Hello from class"
- c) エラーが発生する
- d) 何も出力されない

**正解：** b

**解説：**
Rubyでは、モジュールをインクルード（`include`）すると、そのモジュールのメソッドはクラスのインスタンスメソッドとして使えるようになります。

しかし、**同じ名前のメソッドをクラス内で定義している場合、クラスのメソッド定義が優先されます**（オーバーライドされる）。

これはRubyのメソッド探索パス（method lookup path）に関連しています。メソッドが呼び出されると、Rubyは以下の順序でメソッドを探します：

1. そのクラス自身のインスタンスメソッド
2. インクルードされたモジュール（インクルードされた順番の逆順）
3. 親クラスのインスタンスメソッド
4. さらに上の祖先クラス...

この場合、`hello`メソッドは`Person`クラス自身に定義されているため、モジュールの同名メソッドよりも優先され、"Hello from class"が出力されます。

**公式リファレンス:**

- [Ruby 3.2 リファレンスマニュアル - モジュール](https://docs.ruby-lang.org/ja/latest/class/Module.html)
- [Ruby 3.2 リファレンスマニュアル - クラス/メソッド定義](https://docs.ruby-lang.org/ja/latest/doc/spec=2fdef.html)

---

### 問題2

次のRailsコードで、フォームに入力された値が数値であることを確認するバリデーションとして正しいものはどれですか？

```ruby
class Product < ApplicationRecord
  # ここにバリデーションを追加
end
```

**選択肢：**

- a) `validates :price, numeric: true`
- b) `validates :price, numericality: true`
- c) `validates :price, number: true`
- d) `validates :price, is_number: true`

**正解：** b

**解説：**
Railsの`ActiveRecord::Validations`では、値が数値であることを確認するための組み込みヘルパーとして`numericality`があります。

```ruby
class Product < ApplicationRecord
  validates :price, numericality: true
end
```

これにより、`price`属性に数値以外の値が設定された場合にバリデーションエラーが発生します。さらに詳細な条件を指定することもできます：

```ruby
validates :price, numericality: {
  greater_than: 0,
  less_than: 1000000,
  only_integer: true  # 整数のみを許可
}
```

他の選択肢は存在しないバリデーションオプションです：

- `numeric: true` - このバリデーションは存在しません
- `number: true` - このバリデーションは存在しません
- `is_number: true` - このバリデーションは存在しません

**公式リファレンス:**

- [Rails Guide: ActiveRecord Validations - numericality](https://railsguides.jp/active_record_validations.html#numericality)

---

### 問題3

次のRubyコードで使われているメソッドの役割として正しいものはどれですか？

```ruby
words = ["ruby", "rails", "javascript"]
result = words.inject("") { |memo, word| memo + word.capitalize + " " }
puts result
```

**選択肢：**

- a) `inject`メソッドは配列の各要素を結合するためだけに使われる特殊なメソッド
- b) `inject`メソッドは、初期値を指定して各要素に対して繰り返し処理を行い、累積結果を返すメソッド
- c) `inject`メソッドは、配列の各要素を変換するメソッド（mapと同じ）
- d) `inject`メソッドは、配列内の特定の要素を検索するメソッド

**正解：** b

**解説：**
`inject` メソッド（または同等の `reduce` メソッド）は、初期値と配列の各要素に対して、ブロックで指定された処理を繰り返し適用し、**累積結果**を返すメソッドです。

このコードの例では：

```ruby
words = ["ruby", "rails", "javascript"]
result = words.inject("") { |memo, word| memo + word.capitalize + " " }
puts result  # 出力: "Ruby Rails Javascript "
```

処理の流れは以下のようになります：

1. 初期値 `memo = ""` で開始
2. 最初の要素 "ruby" で処理: `memo = "" + "Ruby" + " "` となり、`memo` は `"Ruby "`
3. 次の要素 "rails" で処理: `memo = "Ruby " + "Rails" + " "` となり、`memo` は `"Ruby Rails "`
4. 最後の要素 "javascript" で処理: `memo = "Ruby Rails " + "Javascript" + " "` となり、`memo` は `"Ruby Rails Javascript "`
5. 最終的に `result` には `"Ruby Rails Javascript "` が代入される

`inject` メソッドは単なる文字列結合だけでなく、数値の合計や積の計算、複雑なデータ構造の構築など、様々な累積処理に利用できる非常に汎用性の高いメソッドです。

シンボルを使った簡潔な書き方もあります：

```ruby
# 配列の合計
[1, 2, 3, 4, 5].inject(0, :+)  # => 15

# 配列の積
[1, 2, 3, 4, 5].inject(1, :*)  # => 120
```

**公式リファレンス:**

- [Ruby 3.2 リファレンス - inject メソッド](https://docs.ruby-lang.org/ja/latest/method/Enumerable/i/inject.html)

---

## 結果

**正解数：** 2/3

**今日のポイント：**

1. Rubyのメソッド探索パスではクラスのメソッドがモジュールのメソッドより優先される
2. Railsで値が数値かどうかを確認するには `numericality: true` を使用する
3. `inject` メソッドは累積的な処理を行う汎用性の高いメソッド
