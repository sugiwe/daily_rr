# Ruby/Rails デイリードリル - 2026-02-06（セッション1）

## 本日のドリル

### 問題1
Rubyのシンボルに関する以下のコードを実行した場合、結果として出力されるのはどれですか？

```ruby
hash = { a: 1, b: 2 }
p hash.keys[0].class
```

**選択肢：**
1. String
2. Symbol
3. Hash
4. Array

**正解：** 2. Symbol

**解説：**
`hash = { a: 1, b: 2 }` という構文は、Rubyで「シンボルをキーとするハッシュ」を作成するための省略記法です。これは内部的には `{ :a => 1, :b => 2 }` と同等です。

したがって、`hash.keys` は `[:a, :b]` というシンボルの配列を返し、その最初の要素 `hash.keys[0]` は `:a` というシンボルになります。そのクラスは `Symbol` です。

**公式リファレンス:**
- [ハッシュ - Ruby 3.2 リファレンスマニュアル](https://docs.ruby-lang.org/ja/latest/class/Hash.html)
- [シンボル - Ruby 3.2 リファレンスマニュアル](https://docs.ruby-lang.org/ja/latest/class/Symbol.html)

---

### 問題2
Railsのモデルで、ユーザーの年齢が18歳以上であることを検証するバリデーションとして最も適切なのはどれですか？

**選択肢：**
1. validates :age, presence: true, minimum: 18
2. validates :age, presence: true, greater_than: 18
3. validates :age, presence: true, greater_than_or_equal_to: 18
4. validates :age, presence: true, min: 18

**正解：** 3

**解説：**
`validates :age, presence: true, greater_than_or_equal_to: 18` が正しい答えです。

このバリデーションは:
- `presence: true` - 年齢が入力されていることを確認
- `greater_than_or_equal_to: 18` - 年齢が18以上（18歳も含む）であることを確認

`greater_than: 18` だと「18より大きい」（19歳以上）という条件になり、18歳は弾かれてしまいます。また、`minimum` と `min` はRailsの標準バリデーションヘルパーではありません。

Railsで数値の検証を行う際は、以下のヘルパーが利用できます:
- greater_than
- greater_than_or_equal_to
- less_than
- less_than_or_equal_to
- equal_to
- other_than
- in (範囲指定)

**公式リファレンス:**
- [Active Record バリデーション - Rails ガイド](https://railsguides.jp/active_record_validations.html#numericality)
- [数値の検証 - Rails API](https://api.rubyonrails.org/classes/ActiveModel/Validations/HelperMethods.html#method-i-validates_numericality_of)

---

### 問題3
以下のRailsコードの実行結果として正しいものを選んでください。

```ruby
class Product < ApplicationRecord
  has_many :reviews
  
  scope :popular, -> { where('average_rating > ?', 4.0) }
  
  def self.best_sellers
    popular.order(sales_count: :desc).limit(5)
  end
end

# コントローラーでの使用
@products = Product.best_sellers.where(category: 'Electronics')
```

**選択肢：**
1. Electronicsカテゴリーの中で、平均評価が4.0より高く、販売数が多い順に並べられた最大5つの商品が取得される
2. Electronicsカテゴリーの全商品から、販売数が多い順に並べられた最大5つの商品が取得される
3. 平均評価が4.0より高く、販売数が多い順に並べられた最大5つの商品の中から、Electronicsカテゴリーに属する商品が取得される
4. Electronicsカテゴリーの中で、平均評価が4.0より高い全ての商品が取得される

**正解：** 1

**解説：**
このコードでは、ActiveRecordのメソッドチェーンが重要です。`Product.best_sellers.where(category: 'Electronics')` というクエリは、実行時に全ての条件が組み合わされて1つのSQLクエリになります。

実際の処理の流れは：
1. `popular` スコープで平均評価が4.0より高い商品をフィルタリング
2. `where(category: 'Electronics')` でElectronicsカテゴリーに絞り込み
3. `order(sales_count: :desc)` で販売数の多い順に並べ替え
4. `limit(5)` で最大5つの商品に制限

これらの条件は全て同時に適用されるため、「Electronicsカテゴリーの中で、平均評価が4.0より高く、販売数が多い順に並べられた最大5つの商品」が取得されます。

選択肢3は間違いです。なぜなら、`limit(5)` は最終的なクエリの一部として適用されるため、「最大5つの商品の中からさらにフィルタリング」ではなく、「全ての条件を満たす商品の中から最大5つ」を取得します。

**公式リファレンス:**
- [Active Record クエリインターフェイス - Rails ガイド](https://railsguides.jp/active_record_querying.html)
- [スコープ - Rails ガイド](https://railsguides.jp/active_record_querying.html#scope)

---

## 結果

**正解数：** 3/3 ⭕⭕⭕

**今日のポイント：**
1. Rubyのハッシュリテラル構文（`{ key: value }` と `{ :key => value }`）と、ハッシュキーがシンボルであることの理解
2. Railsの数値バリデーション（特に `greater_than` と `greater_than_or_equal_to` の違い）
3. ActiveRecordのメソッドチェーンとクエリの構築順序（スコープ、条件、ソート、制限の適用順）